# -*- indent-tabs-mode: nil; -*-

# ./examples $ ppi_ hanoi.scala

@given Conversion[`()`, Int] = _.as[Int]

@val ! : Seq[Any] => IO[Seq[Any]] = { _ => IO.pure(Seq(null)) }

Main = ŒΩ(a,b,c)             \
     ( (!.a<"a">.ùüé)         \
     | (!.b<"b">.ùüé)         \
     | (!.c<"c">.ùüé)         \
     | Hanoi(a,b,c,/*-1*/)  \
     )

Hanoi(a,b,c,n) = ŒΩ(w)                                        \
               ( œÑ/* _ <- IO.print("n = ");                  \
                    'n <- IO.blocking {                      \
                            try                              \
                              scala.io.StdIn.readLine.toInt  \
                            catch _ => -1                    \
                          }                                  \
                   */.                                       \
                 [ /*'n > 0*/ = True ] Hanoi(a,b,c,n,w)      \
               | w(w). a(a)/*!*/. b(b)/*!*/. c(c)/*!*/.      \
                 œÑ/*println(s"#${'w} moves")*/.              \
               )


Move(from,to,z) = from(x).to(y).                    \
                  œÑ/*println(s"${'x} -> ${'y}")*/.  \
                                z</*1*/>.

Hanoi(a,b,c,n,w) = if n = 1                                      \
                   then ŒΩ(z) ( Move(a,c,z) | z(z).w<z>. )        \
                   else ŒΩ(x)                                     \
                      ( Hanoi(a,c,b,/*'n-1*/,x)                  \
                      | x(x). ŒΩ(y)                               \
                              ( Move(a,c,y)                      \
                              | y(y). ŒΩ(z)                       \
                                      ( Hanoi(b,a,c,/*'n-1*/,z)  \
                                      | z(z).w</*'x+'y+'z*/>.    \
                                      )                          \
                              )                                  \
                      )
